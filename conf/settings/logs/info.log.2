2025-06-14 23:03:31,434 celery.app.trace ERROR    Task apps.transactions.tasks.periodic_migration.auto_fix_timeout_issues[b70d843d-16b6-4d34-b95e-5a335eb0a3e8] raised unexpected: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
Traceback (most recent call last):
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 60, in run
    ret = task.retry(exc=exc, **retry_kwargs)
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/task.py", line 736, in retry
    raise_with_context(exc)
    ~~~~~~~~~~~~~~~~~~^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 38, in run
    return task._orig_run(*args, **kwargs)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/apps/transactions/tasks/periodic_migration.py", line 131, in auto_fix_timeout_issues
    transactions_with_multiple_timeouts = EscrowTransaction.objects.annotate(
                                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        active_timeout_count=Count(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
        )
        ^
    ).filter(active_timeout_count__gt=1)
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/manager.py", line 87, in manager_method
    return getattr(self.get_queryset(), name)(*args, **kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1630, in annotate
    return self._annotate(args, kwargs, select=True)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1680, in _annotate
    clone.query.add_annotation(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^
        annotation,
        ^^^^^^^^^^^
        alias,
        ^^^^^^
        select=select,
        ^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1194, in add_annotation
    annotation = annotation.resolve_expression(self, allow_joins=True, reuse=None)
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/aggregates.py", line 63, in resolve_expression
    c = super().resolve_expression(query, allow_joins, reuse, summarize)
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/expressions.py", line 1073, in resolve_expression
    c.source_expressions[pos] = arg.resolve_expression(
                                ~~~~~~~~~~~~~~~~~~~~~~^
        query, allow_joins, reuse, summarize, for_save
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/expressions.py", line 895, in resolve_expression
    return query.resolve_ref(self.name, allow_joins, reuse, summarize)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 2010, in resolve_ref
    join_info = self.setup_joins(
        field_list, self.get_meta(), self.get_initial_alias(), can_reuse=reuse
    )
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1863, in setup_joins
    path, final_field, targets, rest = self.names_to_path(
                                       ~~~~~~~~~~~~~~~~~~^
        names[:pivot],
        ^^^^^^^^^^^^^^
    ...<2 lines>...
        fail_on_missing=True,
        ^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1768, in names_to_path
    raise FieldError(
    ...<2 lines>...
    )
django.core.exceptions.FieldError: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:03:39,393 periodic_migration INFO     Running timeout consistency validation
2025-06-14 23:03:39,396 periodic_migration ERROR    Error in timeout consistency validation: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:03:39,441 celery.app.trace ERROR    Task apps.transactions.tasks.periodic_migration.validate_timeout_consistency[0dad69d8-7fb2-432c-a385-bcb1eeadc308] raised unexpected: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
Traceback (most recent call last):
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 60, in run
    ret = task.retry(exc=exc, **retry_kwargs)
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/task.py", line 736, in retry
    raise_with_context(exc)
    ~~~~~~~~~~~~~~~~~~^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 38, in run
    return task._orig_run(*args, **kwargs)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/apps/transactions/tasks/periodic_migration.py", line 60, in validate_timeout_consistency
    .exclude(
     ~~~~~~~^
        escrowtimeout__is_executed=False, escrowtimeout__is_cancelled=False
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1484, in exclude
    return self._filter_or_exclude(True, args, kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1494, in _filter_or_exclude
    clone._filter_or_exclude_inplace(negate, args, kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1499, in _filter_or_exclude_inplace
    self._query.add_q(~Q(*args, **kwargs))
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1609, in add_q
    clause, _ = self._add_q(q_object, self.used_aliases)
                ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1641, in _add_q
    child_clause, needed_inner = self.build_filter(
                                 ~~~~~~~~~~~~~~~~~^
        child,
        ^^^^^^
    ...<7 lines>...
        update_join_types=update_join_types,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1491, in build_filter
    lookups, parts, reffed_expression = self.solve_lookup_type(arg, summarize)
                                        ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1303, in solve_lookup_type
    _, field, _, lookup_parts = self.names_to_path(lookup_splitted, self.get_meta())
                                ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1768, in names_to_path
    raise FieldError(
    ...<2 lines>...
    )
django.core.exceptions.FieldError: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:04:00,086 periodic_migration INFO     Running periodic timeout scheduling check (max_age_hours=1)
2025-06-14 23:04:00,177 periodic_migration INFO     Periodic timeout scheduling check completed successfully
2025-06-14 23:04:00,182 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.ensure_timeout_scheduling[28ffa43d-f518-4e96-b6f8-dc3f8cf1817c] succeeded in 0.09557545100688003s: 'Periodic timeout scheduling completed'
2025-06-14 23:05:00,068 periodic_migration INFO     Running timeout consistency validation
2025-06-14 23:05:00,070 periodic_migration ERROR    Error in timeout consistency validation: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:05:00,118 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.validate_timeout_consistency[f0625665-cfa8-4043-8dd8-9a788c6244d8] retry: Retry in 2s: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
2025-06-14 23:05:00,211 transition_tasks INFO     Processed 0 expired timeouts
2025-06-14 23:05:00,213 celery.app.trace INFO     Task apps.transactions.tasks.transitions_tasks.check_expired_transactions[cbfc9c2e-3f2b-4eda-8dff-9178482ffc95] succeeded in 0.04662395299965283s: {'processed_count': 0, 'results': []}
2025-06-14 23:05:02,080 periodic_migration INFO     Running timeout consistency validation
2025-06-14 23:05:02,082 periodic_migration ERROR    Error in timeout consistency validation: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:05:02,119 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.validate_timeout_consistency[f0625665-cfa8-4043-8dd8-9a788c6244d8] retry: Retry in 4s: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
2025-06-14 23:05:06,083 periodic_migration INFO     Running timeout consistency validation
2025-06-14 23:05:06,084 periodic_migration ERROR    Error in timeout consistency validation: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:05:06,104 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.validate_timeout_consistency[f0625665-cfa8-4043-8dd8-9a788c6244d8] retry: Retry in 6s: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
2025-06-14 23:05:12,089 periodic_migration INFO     Running timeout consistency validation
2025-06-14 23:05:12,091 periodic_migration ERROR    Error in timeout consistency validation: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:05:12,117 celery.app.trace ERROR    Task apps.transactions.tasks.periodic_migration.validate_timeout_consistency[f0625665-cfa8-4043-8dd8-9a788c6244d8] raised unexpected: FieldError("Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at")
Traceback (most recent call last):
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 453, in trace_task
    R = retval = fun(*args, **kwargs)
                 ~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/trace.py", line 736, in __protected_call__
    return self.run(*args, **kwargs)
           ~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 60, in run
    ret = task.retry(exc=exc, **retry_kwargs)
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/task.py", line 736, in retry
    raise_with_context(exc)
    ~~~~~~~~~~~~~~~~~~^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/celery/app/autoretry.py", line 38, in run
    return task._orig_run(*args, **kwargs)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "/workspaces/apps/transactions/tasks/periodic_migration.py", line 60, in validate_timeout_consistency
    .exclude(
     ~~~~~~~^
        escrowtimeout__is_executed=False, escrowtimeout__is_cancelled=False
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1484, in exclude
    return self._filter_or_exclude(True, args, kwargs)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1494, in _filter_or_exclude
    clone._filter_or_exclude_inplace(negate, args, kwargs)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/query.py", line 1499, in _filter_or_exclude_inplace
    self._query.add_q(~Q(*args, **kwargs))
    ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1609, in add_q
    clause, _ = self._add_q(q_object, self.used_aliases)
                ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1641, in _add_q
    child_clause, needed_inner = self.build_filter(
                                 ~~~~~~~~~~~~~~~~~^
        child,
        ^^^^^^
    ...<7 lines>...
        update_join_types=update_join_types,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1491, in build_filter
    lookups, parts, reffed_expression = self.solve_lookup_type(arg, summarize)
                                        ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1303, in solve_lookup_type
    _, field, _, lookup_parts = self.names_to_path(lookup_splitted, self.get_meta())
                                ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/workspaces/.venv/lib/python3.13/site-packages/django/db/models/sql/query.py", line 1768, in names_to_path
    raise FieldError(
    ...<2 lines>...
    )
django.core.exceptions.FieldError: Cannot resolve keyword 'escrowtimeout' into field. Choices are: amount, auto_transition_type, buyer, buyer_id, created_at, currency, dispute, history, id, inspection_end_date, inspection_period_days, is_auto_transition_scheduled, negotiations, next_auto_transition_at, notes, price_by_negotiation, product, product_id, rating, seller, seller_id, shipping_address, shipping_carrier, status, status_changed_at, timeouts, tracking_id, tracking_number, updated_at
2025-06-14 23:06:00,041 periodic_migration INFO     Running periodic timeout scheduling check (max_age_hours=1)
2025-06-14 23:06:00,121 periodic_migration INFO     Periodic timeout scheduling check completed successfully
2025-06-14 23:06:00,126 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.ensure_timeout_scheduling[9ce40f9b-711c-4313-96b4-9d9fa3f04651] succeeded in 0.08499662699614419s: 'Periodic timeout scheduling completed'
2025-06-14 23:08:00,142 periodic_migration INFO     Running periodic timeout scheduling check (max_age_hours=1)
2025-06-14 23:08:00,239 periodic_migration INFO     Periodic timeout scheduling check completed successfully
2025-06-14 23:08:00,243 celery.app.trace INFO     Task apps.transactions.tasks.periodic_migration.ensure_timeout_scheduling[e0076972-fabe-4013-a562-1841ec065824] succeeded in 0.12031943300098646s: 'Periodic timeout scheduling completed'
